const businessDocumentsConfig = [
  {
    name: "kachay-groshi",
    category: "Качай гроші",
    documents: [
      {
        title: "Витяг з Договору факторингу КАЧА ФП 10 04 24",
        src: "Витяг_з_Договору_факторингу_КАЧА_ФП_10_04_24.pdf",
      },
      {
        title: "Витяг з Реєстру боржників до Договору факторинга КАЧА ФП",
        src: "Витяг_з_Реєстру_боржників_до_Договору_факторинга_КАЧА_ФП.pdf",
      },
      {
        title: "Повідомлення боржникам Качай гроші ФП",
        src: "Повідомлення_боржникам_Качай_гроші_ФП.pdf",
      },
    ],
  },
  {
    name: "eapb-fp",
    category: "ЄАПБ ФП",
    documents: [
      {
        title: "Витяг з Договору факторингу ЄАПБ ФП 23 05 24",
        src: "Витяг_з_Договору_факторингу_ЄАПБ_ФП_23_05_24.pdf",
      },
      {
        title: "Повідомлення боржникам ЄАПБ ФП",
        src: "Повідомлення_боржникам_ЄАПБ_ФП.pdf",
      },
      {
        title: "Витяг з Реєстру заборгованостей №1 ЄАПБ ФП 23 05 24",
        src: "Витяг_з_Реєстру_заборгованостей_№1_ЄАПБ_ФП_23_05_24.pdf",
      },
      {
        title: "Витяг з Реєстру заборгованостей №2 ЄАПБ ФП 23 05 24",
        src: "Витяг_з_Реєстру_заборгованостей_№2_ЄАПБ_ФП_23_05_24.pdf",
      },
      {
        title: "Витяг з Реєстру заборгованостей №3 ЄАПБ ФП 23 05 24",
        src: "Витяг_з_Реєстру_заборгованостей_№3_ЄАПБ_ФП_23_05_24.pdf",
      },
      {
        title: "Витяг з Реєстру заборгованостей №4 ЄАПБ ФП 23 05 24",
        src: "Витяг_з_Реєстру_заборгованостей_№4_ЄАПБ_ФП_23_05_24.pdf",
      },
      {
        title: "Витяг з Реєстру заборгованостей №5 ЄАПБ ФП 23 05 24",
        src: "Витяг_з_Реєстру_заборгованостей_№5_ЄАПБ_ФП_23_05_24.pdf",
      },
    ],
  },
  {
    name: "avans-kredit",
    category: "Аванс кредит",
    documents: [
      {
        title: "Витяг з Договору факторингу АВАНС ФП 29.05.24",
        src: "Витяг_з_Договору_факторингу_АВАНС_ФП_29_05_24.pdf",
      },
      {
        title: "Витяг з Реєстру боржників АВАНС КРЕДИТ ФП 29.05.24",
        src: "Витяг_з_Реєстру_боржників_АВАНС_КРЕДИТ_ФП_29_05_24.pdf",
      },
      {
        title: "Повідомлення боржникам АВАНС КРЕДИТ ФП",
        src: "Повідомлення_боржникам_АВАНС_КРЕДИТ_ФП.pdf",
      },
    ],
  },
  {
    name: "loani",
    category: "КТІК (Лоані)",
    documents: [
      {
        title: "Повідомлення боржникам КТІК ФП",
        src: "Повідомлення_боржникам_КТІК_ФП.pdf",
      },
      {
        title: "Договір Факторингу № 18 12 2023 КТІК ФП",
        src: "Договір_Факторингу_№_18_12_2023_КТІК_ФП.pdf",
      },
      {
        title: "Додаток 3 Реєстр боржників КТІК ФП",
        src: "Додаток_3_Реєстр_боржників_КТІК_ФП.pdf",
      },
    ],
  },
  {
    name: "ukr-kredit-finance",
    category: "УКР КРЕДИТ ФІНАНС",
    documents: [
      {
        title: "Договір факторингу № 02102021_факторинг партнерс",
        src: "ДОГОВІР ФАКТОРИНГУ № 02102021_ФАКТОРИНГ ПАРТНЕРС.pdf",
      },
      {
        title: "Повідомлення боржникам УКР КРЕДИТ ФІНАНС ФП",
        src: "Повідомлення_боржникам_УКР_КРЕДИТ_ФІНАНС_ФП.pdf",
      },
      {
        title: "Витяг з Реєстру боржників 1 (09.11.2021)",
        src: "Витяг з Реєстру_боржників_1_(09.11.2021).pdf",
      },
      {
        title: "Витяг з Реєстру боржників 2 (07.11.2022)",
        src: "Витяг з Реєстру_боржників_2_(07.11.2022).pdf",
      },
      {
        title: "Витяг з Реєстру боржників 3 (18.07.2022)",
        src: "Витяг з Реєстру_боржників_3_(18.07.2022).pdf",
      },
      {
        title: "Витяг з Реєстру боржників 4 (25.07.2022)",
        src: "Витяг з Реєстру_боржників_4_(25.07.2022).pdf",
      },
      {
        title: "Витяг з Реєстру боржників 5 (01.08.2022)",
        src: "Витяг з Реєстру_боржників_5_(01.08.2022).pdf",
      },
      {
        title: "Витяг з Реєстру боржників 6 (08.08.2022)",
        src: "Витяг з Реєстру_боржників_6_(08.08.2022).pdf",
      },
      {
        title: "Витяг з Реєстру боржників 7 (15.08.2022)",
        src: "Витяг з Реєстру_боржників_7_(15.08.2022).pdf",
      },
      {
        title: "Витяг з Реєстру боржників 8 (22.08.2022)",
        src: "Витяг з Реєстру_боржників_8_(22.08.2022).pdf",
      },
      {
        title: "Витяг з Реєстру боржників 9 (06.12.2022)",
        src: "Витяг з Реєстру_боржників_9_(06.12.2022).pdf",
      },
      {
        title: "Витяг з Реєстру боржників 10 (09.02.2023)",
        src: "Витяг з Реєстру_боржників_10_(09.02.2023).pdf",
      },
    ],
  },
  {
    name: "miloan",
    category: "Мілоан",
    documents: [
      {
        title: "Витяг з Договору факторингу Мілоан ФП 24.07.24",
        src: "Витяг_з_Договору_факторингу_Мілоан_ФП_24_07_24.pdf",
      },
      {
        title: "Повідомлення боржникам МІЛОАН ФП 24.07.24",
        src: "Повідомлення_боржникам_МІЛОАН_ФП_24_07_24.pdf",
      },
      {
        title: "Витяг з Реєстру боржників МІЛОАН ФП 24.07.24",
        src: "Витяг_з_Реєстру_боржників_МІЛОАН_ФП_24_07_24.pdf",
      },
      {
        title: "Витяг з Договору факторингу Мілоан ФП 25.07.24",
        src: "Витяг_з_Договору_факторингу_Мілоан_ФП_25_07_24.pdf",
      },
      {
        title: "Повідомлення боржникам МІЛОАН ФП 25.07.24",
        src: "Повідомлення_боржникам_МІЛОАН_ФП_25_07_24.pdf",
      },
      {
        title: "Витяг з Реєстру боржників МІЛОАН ФП 25.07.24",
        src: "Витяг_з_Реєстру_боржників_МІЛОАН_ФП_25_07_24.pdf",
      },
      {
        title: "Витяг з Договору факторингу Мілоан ФП 26.07.24",
        src: "Витяг_з_Договору_факторингу_Мілоан_ФП_26_07_24.pdf",
      },
      {
        title: "Повідомлення боржникам МІЛОАН ФП 26.07.24",
        src: "Повідомлення_боржникам_МІЛОАН_ФП_26_07_24.pdf",
      },
      {
        title: "Витяг з Реєстру боржників МІЛОАН ФП 26.07.24",
        src: "Витяг_з_Реєстру_боржників_МІЛОАН_ФП_26_07_24.pdf",
      },
    ],
  },
];
const DOCUMENTS_PATH = "docs";

function renderBusinessDocuments() {
  const businessLists = document.querySelectorAll("[data-business]");

  if (!businessLists.length) {
    return;
  }

  const handleDocumentClick = (event) => {
    const button = event.currentTarget;
    const wrapper = button.nextElementSibling;

    if (!wrapper || !wrapper.hasAttribute("data-document-wrapper")) {
      return;
    }

    button.classList.toggle("document__accordion--active");
    const isOpening = wrapper.classList.toggle("document__iframe-wrapper--active");

    if (isOpening) {
      if (wrapper.querySelector("iframe")) {
        return;
      }

      const rawSrc = button.getAttribute("data-document-src");
      if (!rawSrc) {
        return;
      }

      const iframe = document.createElement("iframe");
      iframe.className = "document__iframe";
      iframe.loading = "lazy";
      iframe.title = button.textContent?.trim() || "";
      iframe.src = encodeURI(rawSrc);
      wrapper.appendChild(iframe);
      return;
    }

    const iframe = wrapper.querySelector("iframe");
    if (iframe) {
      iframe.remove();
    }
  };

  businessLists.forEach((list) => {
    const businessName = list.getAttribute("data-business");
    const businessConfig = businessDocumentsConfig.find(
      (config) => config.name === businessName
    );

    list.innerHTML = "";
    list.classList.add("documents__list", "documents__list--active");

    if (!businessConfig || !businessConfig.documents.length) {
      return;
    }

    const documentsHtml = businessConfig.documents
      .map((doc, index) => {
        const documentSrc = `${DOCUMENTS_PATH}/${businessName}/${doc?.src || ""}`;
        return `
          <li class="document__item">
            <button
              type="button"
              class="document__accordion"
              data-document-button
              data-document-index="${index}"
              data-document-src="${documentSrc}"
            >
              ${doc.title}
            </button>
            <div class="document__iframe-wrapper" data-document-wrapper></div>
          </li>
        `;
      })
      .join("");

    list.innerHTML = documentsHtml;

    list
      .querySelectorAll("[data-document-button]")
      .forEach((button) => button.addEventListener("click", handleDocumentClick));
  });
}

document.addEventListener("DOMContentLoaded", renderBusinessDocuments);
